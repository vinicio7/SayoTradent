!function(){"use strict";angular.module("app.control",[]).controller("ControlController",["$scope","$filter","$http","$modal","$interval",function($scope,$filter,$http,$modal,$timeout){function createToast(type,message){$scope.toasts.push({anim:"bouncyflip",type:type,msg:message})}function closeAlert(index){$scope.toasts.splice(index,1)}$scope.datas=[],$scope.currentPageStores=[],$scope.searchKeywords="",$scope.filteredData=[],$scope.row="",$scope.numPerPageOpts=[5,10,25,50,100],$scope.numPerPage=$scope.numPerPageOpts[1],$scope.currentPage=1,$scope.positionModel="topRight",$scope.toasts=[];var modal;$scope.select=function(page){var start=(page-1)*$scope.numPerPage,end=start+$scope.numPerPage;$scope.currentPageStores=$scope.filteredData.slice(start,end)},$scope.onFilterChange=function(){$scope.select(1),$scope.currentPage=1,$scope.row=""},$scope.onNumPerPageChange=function(){$scope.select(1),$scope.currentPage=1},$scope.onOrderChange=function(){$scope.select(1),$scope.currentPage=1},$scope.search=function(){$scope.filteredData=$filter("filter")($scope.datas,$scope.searchKeywords),$scope.onFilterChange()},$scope.order=function(rowName){$scope.row!=rowName&&($scope.row=rowName,$scope.filteredData=$filter("orderBy")($scope.datas,rowName),$scope.onOrderChange())},$scope.saveData=function(customer){"new"==$scope.action?(customer.company_id=user_data.company_id,CustomersService.store(customer).then(function(response){response.data.result?(loadDataTable(),modal.close(),createToast("success","<strong>Éxito: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3)):(createToast("danger","<strong>Error: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3))},function(response){createToast("danger","<strong>Error: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3)})):"update"==$scope.action?CustomersService.update(customer).then(function(response){response.data.result?(modal.close(),createToast("success","<strong>Éxito: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3)):(createToast("danger","<strong>Error: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3))},function(response){createToast("danger","<strong>Error: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3)}):"delete"==$scope.action&&CustomersService.destroy(customer.id).then(function(response){response.data.result?(loadDataTable(),modal.close(),createToast("success","<strong>Éxito: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3)):(createToast("danger","<strong>Error: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3))},function(response){createToast("danger","<strong>Error: </strong>"+response.data.message),$timeout(function(){closeAlert(0)},3e3)})},$scope.modalCreateOpen=function(){$scope.customer={},$scope.action="new",console.log("llego a usuarios nuevos"),modal=$modal.open({templateUrl:"views/usuarios/modal_usuarios.html",scope:$scope,size:"lg",resolve:function(){},windowClass:"default"})},$scope.modalEditOpen=function(data){$scope.action="update",$scope.customer=data,modal=$modal.open({templateUrl:"views/control_calidad/modal_control.html",scope:$scope,size:"sm",resolve:function(){},windowClass:"default"})},$scope.modalDeleteOpen=function(data){$scope.action="delete",$scope.customer=data,modal=$modal.open({templateUrl:"views/usuarios/modal_usuarios.html",scope:$scope,size:"md",resolve:function(){},windowClass:"default"})},$scope.modalClose=function(){modal.close()}}])}();